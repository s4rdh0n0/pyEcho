<div class="box box-solid">
    <div class="box-body">
        <div id="formPegawai" class="form-horizontal">
            <input type="hidden" name="userid" value="{{ user['_id'] }}">

            <div class="form-group form-group-md">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="pegawaiid">PegawaiID:</label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                    <input type="text" class="form-control" name="pegawaiid" id="pegawaiid" value="{{ user['pegawaiid'] }}" readonly>
                </div>
            </div>
            <div class="form-group form-group-md">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">Nama:</label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                    <input type="text" class="form-control" name="name" id="name" value="{{ user['nama'] }}" readonly>
                </div>
            </div>
        </div>
        <form id="formAddRole" class="form-horizontal">
            <div class="form-group">
                <label for="node" class="control-label col-md-3 col-sm-3 col-xs-12"> Role:</label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                    <select id="role" class="select2 form-control" style="width: 100%;">
                        {% for item in typeregister %}
                        <option value="{{ item['code'] }}">{{ item['description'] }}</option>
                        {% end %}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                    <div class="pull-right">
                        <button type="submit" id="registerrole" name="registerrole" class="btn btn-primary btn-flat"><i class="fa fa-save"></i> Simpan</button>
                    </div>
                </div>
            </div>
        </form>

        <!-- TableRole -->
        <table id="tableRole" class="table table-striped table-bordered dt-responsive" style="width:100%">
            <thead>
                <tr>
                    <th>Key</th>
                    <th>No</th>
                    <th>Role</th>
                    <th>Create Date</th>
                    <th></th>
                </tr>
            </thead>
            <tbody style="cursor: pointer;">
            </tbody>
        </table>
        <!-- ./TableRole -->
    </div>
    <div class="box-footer">
        <script>
            $("#role").select2({
                placeholder: "Pilih role..",
                theme: "bootstrap"
            });
            
            /* Initial Add Role */
            $('#formAddRole').validate({
                submitHandler: function (form) {
                    $.ajax({
                        type: 'POST',
                        url: '/administrator/daftarpegawai/role',
                        data: JSON.stringify({
                            userid: $('input[name=userid]').val(),
                            key: $('#role').val()
                        }),
                        headers: { 'X-XSRFToken': $('input[name="_xsrf"]').val() },
                        success: (function (data) {
                            if (data.status){
                                $('#tableRole').DataTable().ajax.reload();
                            }
                        }),
                        error: (function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("Error: " + errorThrown);
                        })
                    });
                }
            });

            /* Initial Table Role */
            var tableRole = $('#tableRole').DataTable({
                'processing': true,
                'serverSide': true,
                'ajax': function (data, callback) {
                    $.ajax({
                        type: 'GET',
                        url: '/administrator/daftarpegawai/role/userid=' + $('input[name=userid]').val(),
                        headers: { 'X-XSRFToken': $('input[name="_xsrf"]').val() },
                        success: (function (data) {
                            // NOTE: print data
                            console.log(data)

                            // NOTE: callback response ajax
                            callback(data);
                        }),
                        error: (function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("Error: " + errorThrown);
                        })
                    })
                },
                'columns': [
                    {
                        "targets": [0],
                        "visible": false,
                        "data": 'key',
                    },{
                        "targets": [1],
                        "width": "5%",
                        "className": "dt-center text-center",
                        "render": function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },{
                        "targets": [2],
                        "width": "70%",
                        "data": 'description',
                        "className": "dt-center text-center",
                    },{
                        "targets": [3],
                        "width": "20%",
                        "data": 'createdate',
                        "className": "dt-center text-center",
                        "render": function (data) {
                            var date = new Date(data);
                            var month = date.getMonth() + 1;
                            return date.getDate() + "/" + (month.toString().length > 1 ? month : "0" + month) + "/" + date.getFullYear() + "  " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
                        }
                    },{ 
                        "targets": [4],
                        "width": "5%",
                        "className": "dt-center text-center",
                        "render": function () {
                            return '<a id="btnDeleteRole" class="btn btn-danger btn-flat"><i class="fa fa-times" aria-hidden="true"></i></a>';
                        }
                    }
                ],
                'responsive': true,
                'paging': false,
                'autoWidth': false,
                'pagingType': 'simple_numbers',
                'lengthChange': false,
                'ordering': false,
                'searching': false,
                'info': true
            });
        </script>
    </div>
</div>